// - ------------------------------------------------------------------------------------------ - //
#ifdef USES_WINDOWS_TIME
// - ------------------------------------------------------------------------------------------ - //
#include <Lib/Lib.h>
// - ------------------------------------------------------------------------------------------ - //
#include <windows.h>	// timeGetTime //
#include <time.h>		// time, time_t //
// - ------------------------------------------------------------------------------------------ - //

// - ------------------------------------------------------------------------------------------ - //
// Fixed version of timeGetTime //
// - ------------------------------------------------------------------------------------------ - //
inline DWORD timeGetTime32() {
	// WARNING: Wraps every 49 days! Time in MS since the computer started! //
	return timeGetTime();
}
// - ------------------------------------------------------------------------------------------ - //
GelTime _timeGetTime64() {
	static GelTime TickBase = 0ULL;
	static DWORD LastTick = timeGetTime32();
	
	DWORD ThisTick = timeGetTime32();
	if ( ThisTick < LastTick ) {
		TickBase += 1ULL << 32;
	}
	LastTick = ThisTick;
	return TickBase + (GelTime)ThisTick;
}
// - ------------------------------------------------------------------------------------------ - //
GelTime timeGetTime64() {
	static GelTime Base = _timeGetTime64();
	return _timeGetTime64() - Base;
}
// - ------------------------------------------------------------------------------------------ - //


// - ------------------------------------------------------------------------------------------ - //
// Init //
// - ------------------------------------------------------------------------------------------ - //
void gelsTimeInit() {	
}
// - ------------------------------------------------------------------------------------------ - //


// - ------------------------------------------------------------------------------------------ - //
// Start Time Functions //
// - ------------------------------------------------------------------------------------------ - //
GelTime get_s_GelTime() {
	return timeGetTime64() / 1000ull;
}
// - ------------------------------------------------------------------------------------------ - //
GelTime get_ms_GelTime() {
	return timeGetTime64();
}
// - ------------------------------------------------------------------------------------------ - //
GelTime get_us_GelTime() {
	return timeGetTime64() * 1000ull;
}
// - ------------------------------------------------------------------------------------------ - //

// - ------------------------------------------------------------------------------------------ - //
// Current Time Functions //
// - ------------------------------------------------------------------------------------------ - //
GelTime get_time_GelTime() {
	return time(0);
}
// - ------------------------------------------------------------------------------------------ - //

// - ------------------------------------------------------------------------------------------ - //
#endif // USES_WINDOWS_TIME //
// - ------------------------------------------------------------------------------------------ - //
